# 可视化编辑功能说明

## 功能概述

应用对话页面新增了可视化编辑功能，允许用户通过可视化方式选择网页元素，并将选中的元素信息添加到对话提示词中。

## 功能特性

### 1. 编辑模式切换
- 在对话框输入框左侧添加了编辑模式按钮（铅笔图标）
- 点击按钮可以进入/退出编辑模式
- 只有在有权限编辑且网页已加载时才显示按钮

### 2. 元素选择
- 进入编辑模式后，鼠标悬浮在网页元素上会显示蓝色虚线边框
- 点击元素会选中该元素，边框变为绿色实线
- 选中的元素信息会显示在输入框上方的Alert组件中

### 3. 元素信息显示
- 选中元素后，会在输入框上方显示元素信息
- 包含元素标签、文本内容等信息
- 可以通过关闭按钮移除选中状态

### 4. 智能提示词
- 发送消息时，如果已选中元素，会自动将元素信息添加到提示词中
- 包含元素的标签、选择器、文本内容、位置、尺寸等详细信息
- 发送后自动清除选中状态并退出编辑模式

## 技术实现

### 核心组件
- `VisualEditor` 类：负责管理iframe内的可视化编辑功能
- `ElementInfo` 接口：定义元素信息的数据结构

### 主要功能
1. **iframe通信**：通过postMessage实现主页面与iframe的通信
2. **元素检测**：在iframe内注入脚本，监听鼠标事件
3. **样式注入**：动态注入CSS样式，实现悬浮和选中效果
4. **状态管理**：管理编辑模式状态和选中元素信息

### 文件结构
```
src/
├── utils/
│   └── visualEditor.ts          # 可视化编辑器工具类
└── pages/
    └── AppChatPage.vue          # 应用对话页面（已集成编辑功能）
```

## 使用流程

1. **进入应用对话页面**
2. **等待网页加载完成**：确保右侧预览区域显示网页内容
3. **点击编辑模式按钮**：输入框左侧的铅笔图标
4. **选择元素**：
   - 悬浮查看元素边框
   - 点击选中目标元素
5. **查看元素信息**：输入框上方会显示选中的元素信息
6. **输入提示词**：描述你想要的修改
7. **发送消息**：系统会自动将元素信息添加到提示词中
8. **自动退出编辑模式**：发送后自动清除选中状态

## 注意事项

- 编辑功能仅在用户有编辑权限时可用
- 需要等待网页完全加载后才能使用编辑功能
- 选中的元素信息会包含在发送给后端的提示词中
- 发送消息后会自动退出编辑模式，需要重新进入才能继续选择元素

## 兼容性

- 支持所有现代浏览器
- 需要iframe支持（用于网页预览）
- 需要postMessage API支持（用于跨iframe通信）
